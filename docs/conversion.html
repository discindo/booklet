<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Поглавје 4 Конверзија во повторлив код | Препораки за повторливо анализирање на податоци</title>
  <meta name="description" content="Прирачник за повторливо анализирање и објавување на податоци. Дискутираме теми, процедури, и алатки од R екосистемот кои олеснуваат обработка на податоци со најдобрите и најбезбедни пракси и кои овозможуваат повторување на анализите со минимален труд од страна на надворешен корисник." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Поглавје 4 Конверзија во повторлив код | Препораки за повторливо анализирање на податоци" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Прирачник за повторливо анализирање и објавување на податоци. Дискутираме теми, процедури, и алатки од R екосистемот кои олеснуваат обработка на податоци со најдобрите и најбезбедни пракси и кои овозможуваат повторување на анализите со минимален труд од страна на надворешен корисник." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Поглавје 4 Конверзија во повторлив код | Препораки за повторливо анализирање на податоци" />
  
  <meta name="twitter:description" content="Прирачник за повторливо анализирање и објавување на податоци. Дискутираме теми, процедури, и алатки од R екосистемот кои олеснуваат обработка на податоци со најдобрите и најбезбедни пракси и кои овозможуваат повторување на анализите со минимален труд од страна на надворешен корисник." />
  

<meta name="author" content="Теофил Наков, Новица Наков, Слободен софтвер Македонија" />


<meta name="date" content="2020-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="nogood.html"/>
<link rel="next" href="rmd.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Повторлива анализа на податоци</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Резиме</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Вовед</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#analogy"><i class="fa fa-check"></i><b>1.1</b> Аналогија</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#audience"><i class="fa fa-check"></i><b>1.2</b> За кого е наменет овој прирачник</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#organ"><i class="fa fa-check"></i><b>1.3</b> Организација</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#за-овој-прирачник"><i class="fa fa-check"></i><b>1.4</b> За овој прирачник</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#лиценца"><i class="fa fa-check"></i><b>1.5</b> Лиценца</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>2</b> Алатки</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tools.html"><a href="tools.html#програмски-јазик-r"><i class="fa fa-check"></i><b>2.1</b> Програмски јазик: <code>R</code></a></li>
<li class="chapter" data-level="2.2" data-path="tools.html"><a href="tools.html#инсталација"><i class="fa fa-check"></i><b>2.2</b> Инсталација</a></li>
<li class="chapter" data-level="2.3" data-path="tools.html"><a href="tools.html#контрола-на-изворен-код-git"><i class="fa fa-check"></i><b>2.3</b> Контрола на изворен код: <code>git</code></a></li>
<li class="chapter" data-level="2.4" data-path="tools.html"><a href="tools.html#резиме-1"><i class="fa fa-check"></i><b>2.4</b> Резиме</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="nogood.html"><a href="nogood.html"><i class="fa fa-check"></i><b>3</b> Анализи што не може да се повторат</a>
<ul>
<li class="chapter" data-level="3.1" data-path="nogood.html"><a href="nogood.html#typical"><i class="fa fa-check"></i><b>3.1</b> Типична анализа (која никој, дури ни авторот, не може да ја повтори)</a></li>
<li class="chapter" data-level="3.2" data-path="nogood.html"><a href="nogood.html#indicators"><i class="fa fa-check"></i><b>3.2</b> Типични пракси кои доведуваат до не-повторливи анализи</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="conversion.html"><a href="conversion.html"><i class="fa fa-check"></i><b>4</b> Конверзија во повторлив код</a>
<ul>
<li class="chapter" data-level="4.1" data-path="conversion.html"><a href="conversion.html#податоци"><i class="fa fa-check"></i><b>4.1</b> Податоци</a></li>
<li class="chapter" data-level="4.2" data-path="conversion.html"><a href="conversion.html#први-чекори-кон-повторливост"><i class="fa fa-check"></i><b>4.2</b> Први чекори кон повторливост</a></li>
<li class="chapter" data-level="4.3" data-path="conversion.html"><a href="conversion.html#функција"><i class="fa fa-check"></i><b>4.3</b> Функција</a></li>
<li class="chapter" data-level="4.4" data-path="conversion.html"><a href="conversion.html#rscript-што-може-да-го-користиме-без-да-отвараме-r"><i class="fa fa-check"></i><b>4.4</b> Rscript што може да го користиме без да отвараме <code>R</code></a></li>
<li class="chapter" data-level="4.5" data-path="conversion.html"><a href="conversion.html#резиме-2"><i class="fa fa-check"></i><b>4.5</b> Резиме</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rmd.html"><a href="rmd.html"><i class="fa fa-check"></i><b>5</b> Повторливи документи / извештаи со писмено програмирање (R + markdown)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rmd.html"><a href="rmd.html#форматирање-на-текст-со-markdown"><i class="fa fa-check"></i><b>5.1</b> Форматирање на текст со markdown</a></li>
<li class="chapter" data-level="5.2" data-path="rmd.html"><a href="rmd.html#плетење-на-текст-код-и-резултати-со-knitr"><i class="fa fa-check"></i><b>5.2</b> Плетење на текст, код, и резултати со <code>knitr</code></a></li>
<li class="chapter" data-level="5.3" data-path="rmd.html"><a href="rmd.html#извештаи-со-параметри"><i class="fa fa-check"></i><b>5.3</b> Извештаи со параметри</a></li>
<li class="chapter" data-level="5.4" data-path="rmd.html"><a href="rmd.html#следни-чекори"><i class="fa fa-check"></i><b>5.4</b> Следни чекори</a></li>
<li class="chapter" data-level="5.5" data-path="rmd.html"><a href="rmd.html#резиме-3"><i class="fa fa-check"></i><b>5.5</b> Резиме</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="proekti.html"><a href="proekti.html"><i class="fa fa-check"></i><b>6</b> Повторливи проекти</a>
<ul>
<li class="chapter" data-level="6.1" data-path="proekti.html"><a href="proekti.html#стратегија-1-направи-сам"><i class="fa fa-check"></i><b>6.1</b> Стратегија 1: Направи сам</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="proekti.html"><a href="proekti.html#структура"><i class="fa fa-check"></i><b>6.1.1</b> Структура</a></li>
<li class="chapter" data-level="6.1.2" data-path="proekti.html"><a href="proekti.html#предности"><i class="fa fa-check"></i><b>6.1.2</b> Предности</a></li>
<li class="chapter" data-level="6.1.3" data-path="proekti.html"><a href="proekti.html#недостатоци"><i class="fa fa-check"></i><b>6.1.3</b> Недостатоци</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="proekti.html"><a href="proekti.html#стратегија-2-формален-r-пакет-или-некоја-поедноставена-варијанта"><i class="fa fa-check"></i><b>6.2</b> Стратегија 2: Формален <code>R</code> пакет или некоја поедноставена варијанта</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="proekti.html"><a href="proekti.html#структура-1"><i class="fa fa-check"></i><b>6.2.1</b> Структура</a></li>
<li class="chapter" data-level="6.2.2" data-path="proekti.html"><a href="proekti.html#поставување"><i class="fa fa-check"></i><b>6.2.2</b> Поставување</a></li>
<li class="chapter" data-level="6.2.3" data-path="proekti.html"><a href="proekti.html#предности-1"><i class="fa fa-check"></i><b>6.2.3</b> Предности</a></li>
<li class="chapter" data-level="6.2.4" data-path="proekti.html"><a href="proekti.html#недостатоци-1"><i class="fa fa-check"></i><b>6.2.4</b> Недостатоци</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="proekti.html"><a href="proekti.html#резиме-4"><i class="fa fa-check"></i><b>6.3</b> Резиме</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>7</b> Контрола на изворниот код со git и GitHub</a>
<ul>
<li class="chapter" data-level="7.1" data-path="git.html"><a href="git.html#основи-на-git"><i class="fa fa-check"></i><b>7.1</b> Основи на <code>git</code></a></li>
<li class="chapter" data-level="7.2" data-path="git.html"><a href="git.html#основи-на-github-за-соработка-и-објавување"><i class="fa fa-check"></i><b>7.2</b> Основи на GitHub за соработка и објавување</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="git.html"><a href="git.html#потребен-софтвер"><i class="fa fa-check"></i><b>7.2.1</b> Потребен софтвер</a></li>
<li class="chapter" data-level="7.2.2" data-path="git.html"><a href="git.html#поставување-1"><i class="fa fa-check"></i><b>7.2.2</b> Поставување</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="git.html"><a href="git.html#резиме-5"><i class="fa fa-check"></i><b>7.3</b> Резиме</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="литература.html"><a href="литература.html"><i class="fa fa-check"></i>Литература</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Објавено со bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Препораки за повторливо анализирање на податоци</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="conversion" class="section level1" number="4">
<h1><span class="header-section-number">Поглавје 4</span> Конверзија во повторлив код</h1>
<div id="податоци" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Податоци</h2>
<p>За да може да ги видиме следните чекори во акција неопходни ни се податоци. Табелата за трошоци има три колони (варијабли) <code>vraboten</code>, <code>tip_na_trosok</code> и <code>cena</code>. Еве ги првите неколку редови:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="conversion.html#cb4-1" aria-hidden="true" tabindex="-1"></a>trosoci</span></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##    vraboten    tip_na_trosok            cena
##    &lt;chr&gt;       &lt;chr&gt;                   &lt;dbl&gt;
##  1 Ана И.      печатење                   75
##  2 Ристе Н.    транспорт                  81
##  3 Ана И.      печатење                   13
##  4 Благоја В.  канцелариски материјали    40
##  5 Антонија А. транспорт                  89
##  6 Љупчо В.    печатење                   48
##  7 Благоја В.  канцелариски материјали    96
##  8 Љупчо В.    канцелариски материјали    23
##  9 Љупчо В.    транспорт                  84
## 10 Ана И.      печатење                   29
## # … with 20 more rows</code></pre>
<p>Трансформацијата која ја прави нашиот, сѐ уште неповторлив, код можеме исто така да ја видиме во акција:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="conversion.html#cb6-1" aria-hidden="true" tabindex="-1"></a>trosoci <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="conversion.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="conversion.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="conversion.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   vraboten [5]
##    vraboten    tip_na_trosok            cena
##    &lt;chr&gt;       &lt;chr&gt;                   &lt;dbl&gt;
##  1 Ана И.      канцелариски материјали    31
##  2 Ана И.      печатење                  177
##  3 Ана И.      транспорт                  51
##  4 Антонија А. печатење                  324
##  5 Антонија А. транспорт                 111
##  6 Благоја В.  канцелариски материјали   196
##  7 Благоја В.  печатење                  218
##  8 Благоја В.  транспорт                  54
##  9 Љупчо В.    канцелариски материјали    23
## 10 Љупчо В.    печатење                   48
## 11 Љупчо В.    транспорт                 127
## 12 Ристе Н.    транспорт                 116</code></pre>
</div>
<div id="први-чекори-кон-повторливост" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Први чекори кон повторливост</h2>
<p>Откако сме ги согледале проблемите што доведуваат до тоа резултатот од нашиот код да не може да се повтори (без колегата да почне да чепка и кодира од почеток), можеме да интервенираме. За нашиот код да биде повторлив, минимално треба:</p>
<ol style="list-style-type: decimal">
<li><p>Да ги повикува <code>R</code> пакетите кои се неопходни за функциите што ги користиме</p></li>
<li><p>Да не користи апсолутни патеки за вчитување и зачувување на патоци коишто се надвор од фолдерот во кој што е сместена самата скрипта</p></li>
<li><p>Да биде детално документиран</p></li>
</ol>
<p>Што се однесува до првиот проблем, кодот едноставно нема да работи без пакетите <a href="https://www.rdocumentation.org/packages/readr/versions/1.3.1"><code>readr</code></a> <span class="citation">(<a href="литература.html#ref-R-readr" role="doc-biblioref">Wickham, Hester, and Francois 2018</a>)</span> и <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.8"><code>dplyr</code></a> <span class="citation">(<a href="литература.html#ref-R-dplyr" role="doc-biblioref">Wickham, François, et al. 2020</a>)</span> да се вчитани па дури и нашиот колега да ги има истите фајлови на истите локации како ние. Оваа корекција е едноставна:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="conversion.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ги ти пакетите кои се користат подолу </span></span>
<span id="cb8-2"><a href="conversion.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-3"><a href="conversion.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb8-4"><a href="conversion.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="conversion.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Доколку не се достапни, инсталирај од CRAN со:</span></span>
<span id="cb8-6"><a href="conversion.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb8-7"><a href="conversion.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;readr&quot;)</span></span>
<span id="cb8-8"><a href="conversion.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="conversion.html#cb8-9" aria-hidden="true" tabindex="-1"></a>trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/trosoci-moja-firma.csv&quot;</span>)</span>
<span id="cb8-10"><a href="conversion.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="conversion.html#cb8-11" aria-hidden="true" tabindex="-1"></a>trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="conversion.html#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="conversion.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="conversion.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb8-15"><a href="conversion.html#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="conversion.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(trosoci_sumirani, </span>
<span id="cb8-17"><a href="conversion.html#cb8-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> <span class="st">&quot;data/trosoci-moja-firma-sumirani.csv&quot;</span>)</span></code></pre></div>
<p>Што се однесува до втората задача, имаме повеќе можности. Можеме да побараме корисникот да ја зачува патеката во варијабла која ќе биде користена од понатамошниот код. Ова се уште дозволува патеки во друг директориум, и очигледно бара соодветна интервенција од корисникот, но ако ништо друго, корисникот на овој код, доколку ја прочита документацијата (значи снаоѓањето <em>зависи</em> од нашата инвестиција кон добра документација), може барем да ја повтори анализата без да добие грешки:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="conversion.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ги ти пакетите кои се користат подолу </span></span>
<span id="cb9-2"><a href="conversion.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-3"><a href="conversion.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb9-4"><a href="conversion.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="conversion.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Доколку не се достапни, инсталирај со:</span></span>
<span id="cb9-6"><a href="conversion.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb9-7"><a href="conversion.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;readr&quot;)</span></span>
<span id="cb9-8"><a href="conversion.html#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="conversion.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ВНИМАНИЕ:</span></span>
<span id="cb9-10"><a href="conversion.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Скриптата нема да работи доколку не внесете валидни дестинации</span></span>
<span id="cb9-11"><a href="conversion.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># за фајлови за вчитување и зачувување</span></span>
<span id="cb9-12"><a href="conversion.html#cb9-12" aria-hidden="true" tabindex="-1"></a>pateka_do_input <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># &quot;data/trosoci-moja-firma.csv&quot;</span></span>
<span id="cb9-13"><a href="conversion.html#cb9-13" aria-hidden="true" tabindex="-1"></a>pateka_za_output <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># &quot;data/trosoci-moja-firma-sumirani.csv&quot;</span></span>
<span id="cb9-14"><a href="conversion.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="conversion.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># На пример:</span></span>
<span id="cb9-16"><a href="conversion.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># pateka_do_input &lt;- &quot;~/Downloads/trosoci-moja-firma.csv&quot; </span></span>
<span id="cb9-17"><a href="conversion.html#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># pateka_do_output &lt;- &quot;~/Downloads/trosoci-moja-firma-sumirani.csv&quot; </span></span>
<span id="cb9-18"><a href="conversion.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="conversion.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># или:</span></span>
<span id="cb9-20"><a href="conversion.html#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># pateka_do_input &lt;- &quot;C:\rabota\podatoci\trosoci\trosoci-moja-firma.csv&quot;</span></span>
<span id="cb9-21"><a href="conversion.html#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># pateka_do_output &lt;- &quot;C:\rabota\podatoci\trosoci\trosoci-moja-firma-sumirani.csv&quot;</span></span>
<span id="cb9-22"><a href="conversion.html#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="conversion.html#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ги податоците</span></span>
<span id="cb9-24"><a href="conversion.html#cb9-24" aria-hidden="true" tabindex="-1"></a>trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(pateka_do_input)</span>
<span id="cb9-25"><a href="conversion.html#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="conversion.html#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Групирај и пресметај суми</span></span>
<span id="cb9-27"><a href="conversion.html#cb9-27" aria-hidden="true" tabindex="-1"></a>trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span> </span>
<span id="cb9-28"><a href="conversion.html#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span> </span>
<span id="cb9-29"><a href="conversion.html#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-30"><a href="conversion.html#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb9-31"><a href="conversion.html#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="conversion.html#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Зачувај</span></span>
<span id="cb9-33"><a href="conversion.html#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(trosoci_sumirani, </span>
<span id="cb9-34"><a href="conversion.html#cb9-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">path =</span> pateka_za_output)</span></code></pre></div>
</div>
<div id="функција" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Функција</h2>
<p>Алтернатива која бара малку поголема подготовка е да го напишеме функција којашто ќе работи на ист начин, земајќи ги патеките како аргументи:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="conversion.html#cb10-1" aria-hidden="true" tabindex="-1"></a>sumiraj_trosoci <span class="ot">&lt;-</span> <span class="cf">function</span>(trosoci, destinacija) {</span>
<span id="cb10-2"><a href="conversion.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-3"><a href="conversion.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Вчитај ги податоците</span></span>
<span id="cb10-4"><a href="conversion.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(trosoci)</span>
<span id="cb10-5"><a href="conversion.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-6"><a href="conversion.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Групирај и пресметај суми</span></span>
<span id="cb10-7"><a href="conversion.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="conversion.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="conversion.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="conversion.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb10-11"><a href="conversion.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="conversion.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Зачувај</span></span>
<span id="cb10-13"><a href="conversion.html#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(trosoci_sumirani,</span>
<span id="cb10-14"><a href="conversion.html#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">path =</span> destinacija)</span>
<span id="cb10-15"><a href="conversion.html#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Често, сакаме табелата којашто ја снимаме да го има истото основно име како табелата што ја трансформираме (на пример <code>moja-tabela.csv</code> и <code>moja-tabela-medijani.csv</code>) и да се наоѓа во истиот фолдер. Со малку манипулација на текст во <code>R</code> (ова е уште полесно во <code>Python</code>) добиваме:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="conversion.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Функција за групирање и сумирање трошоци</span></span>
<span id="cb11-2"><a href="conversion.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Аргументот `trosoci` е патека до табелата што треба да се трансформира</span></span>
<span id="cb11-3"><a href="conversion.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="conversion.html#cb11-4" aria-hidden="true" tabindex="-1"></a>sumiraj_trosoci <span class="ot">&lt;-</span> <span class="cf">function</span>(trosoci_tabela) {</span>
<span id="cb11-5"><a href="conversion.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="conversion.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Вчитај ги податоците</span></span>
<span id="cb11-7"><a href="conversion.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(trosoci_tabela)</span>
<span id="cb11-8"><a href="conversion.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="conversion.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Групирај и пресметај суми</span></span>
<span id="cb11-10"><a href="conversion.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="conversion.html#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="conversion.html#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="conversion.html#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb11-14"><a href="conversion.html#cb11-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-15"><a href="conversion.html#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Направи патека за дестинација</span></span>
<span id="cb11-16"><a href="conversion.html#cb11-16" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">dirname</span>(trosoci_tabela)</span>
<span id="cb11-17"><a href="conversion.html#cb11-17" aria-hidden="true" tabindex="-1"></a>  base_name <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(<span class="fu">basename</span>(trosoci_tabela))</span>
<span id="cb11-18"><a href="conversion.html#cb11-18" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(base_name, <span class="st">&quot;sumirani.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb11-19"><a href="conversion.html#cb11-19" aria-hidden="true" tabindex="-1"></a>  destinacija <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder_name, new_name)</span>
<span id="cb11-20"><a href="conversion.html#cb11-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-21"><a href="conversion.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Зачувај</span></span>
<span id="cb11-22"><a href="conversion.html#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(trosoci_sumirani, <span class="at">path =</span> destinacija)</span>
<span id="cb11-23"><a href="conversion.html#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Целата скрипта по овие промени би изгледала вака:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="conversion.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Употреба:</span></span>
<span id="cb12-2"><a href="conversion.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ја оваа скипта во R за да ја користиш функцијата `sumiraj_trosoci`  </span></span>
<span id="cb12-3"><a href="conversion.html#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="conversion.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ги ти пакетите кои се користат подолу </span></span>
<span id="cb12-5"><a href="conversion.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-6"><a href="conversion.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb12-7"><a href="conversion.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="conversion.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Доколку не се достапни, инсталирај со:</span></span>
<span id="cb12-9"><a href="conversion.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb12-10"><a href="conversion.html#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;readr&quot;)</span></span>
<span id="cb12-11"><a href="conversion.html#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="conversion.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Функција за групирање и сумирање трошоци</span></span>
<span id="cb12-13"><a href="conversion.html#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Аргументот `trosoci` е патека до табелата што треба да се трансформира</span></span>
<span id="cb12-14"><a href="conversion.html#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="conversion.html#cb12-15" aria-hidden="true" tabindex="-1"></a>sumiraj_trosoci <span class="ot">&lt;-</span> <span class="cf">function</span>(trosoci_tabela) {</span>
<span id="cb12-16"><a href="conversion.html#cb12-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-17"><a href="conversion.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Вчитај ги податоците</span></span>
<span id="cb12-18"><a href="conversion.html#cb12-18" aria-hidden="true" tabindex="-1"></a>  trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(trosoci_tabela)</span>
<span id="cb12-19"><a href="conversion.html#cb12-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-20"><a href="conversion.html#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Групирај и пресметај суми</span></span>
<span id="cb12-21"><a href="conversion.html#cb12-21" aria-hidden="true" tabindex="-1"></a>  trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href="conversion.html#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span></span>
<span id="cb12-23"><a href="conversion.html#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-24"><a href="conversion.html#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb12-25"><a href="conversion.html#cb12-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-26"><a href="conversion.html#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Направи патека за дестинација</span></span>
<span id="cb12-27"><a href="conversion.html#cb12-27" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">dirname</span>(trosoci_tabela)</span>
<span id="cb12-28"><a href="conversion.html#cb12-28" aria-hidden="true" tabindex="-1"></a>  base_name <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(<span class="fu">basename</span>(trosoci_tabela))</span>
<span id="cb12-29"><a href="conversion.html#cb12-29" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(base_name, <span class="st">&quot;sumirani.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb12-30"><a href="conversion.html#cb12-30" aria-hidden="true" tabindex="-1"></a>  destinacija <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder_name, new_name)</span>
<span id="cb12-31"><a href="conversion.html#cb12-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-32"><a href="conversion.html#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Зачувај</span></span>
<span id="cb12-33"><a href="conversion.html#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(trosoci_sumirani, <span class="at">path =</span> destinacija)</span>
<span id="cb12-34"><a href="conversion.html#cb12-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Што сме постигнале до сега? Зависностите на кодот се решени. Документација имаме, впрочем, пишување на коментари во кодот треба да стане навика. И имаме функција на која може да и дадеме табела која што се наоѓа било каде и да зачуваме сумирана табела во истата папка.</p>
</div>
<div id="rscript-што-може-да-го-користиме-без-да-отвараме-r" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Rscript што може да го користиме без да отвараме <code>R</code></h2>
<p>Нашиот код е далеку подобар и има повеќе шанси да работи на други компјутери, но се уште може да се каже дека има некои недостатоци. На пример, корисникот <em>мора</em> да отвори <code>R</code>, да ја вчита скриптата, и да ја изврши функцијата. Тоа е можеби во ред доколку нашиот колега има доволно познавање од <code>R</code>, но можеби нашиот шеф не знае <code>R</code> или едноставно нема време за чепкање во <code>R</code> терминал. Можеби сака решение од една линија налик на следното:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="conversion.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript.exe</span> sumiraj_trosoci.R trosoci_dekemvri_2020.csv</span></code></pre></div>
<p>Да го конвертираме нашиот код во ваква скрипта е лесно. Доколку кодот го процесираме со <a href="https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/Rscript"><code>Rscript</code></a>, треба само да го земеме името на датотеката даден по името на скриптата (тоа е табелата со трошоци), и да го предадеме на нашата функција (внатре во скриптата):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="conversion.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (data/sumiraj-trosoci-1.R)</span></span>
<span id="cb14-2"><a href="conversion.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="conversion.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Употреба:</span></span>
<span id="cb14-4"><a href="conversion.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ја оваа скипта во R за да ја користиш функцијата `sumiraj_trosoci`  </span></span>
<span id="cb14-5"><a href="conversion.html#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="conversion.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Закачи ги ти пакетите кои се користат подолу </span></span>
<span id="cb14-7"><a href="conversion.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-8"><a href="conversion.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb14-9"><a href="conversion.html#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="conversion.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Доколку не се достапни, инсталирај со:</span></span>
<span id="cb14-11"><a href="conversion.html#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb14-12"><a href="conversion.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;readr&quot;)</span></span>
<span id="cb14-13"><a href="conversion.html#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="conversion.html#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Функција за групирање и сумирање трошоци</span></span>
<span id="cb14-15"><a href="conversion.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Аргументот `trosoci` е патека до табелата што треба да се трансформира</span></span>
<span id="cb14-16"><a href="conversion.html#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="conversion.html#cb14-17" aria-hidden="true" tabindex="-1"></a>sumiraj_trosoci <span class="ot">&lt;-</span> <span class="cf">function</span>(trosoci_tabela) {</span>
<span id="cb14-18"><a href="conversion.html#cb14-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-19"><a href="conversion.html#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Вчитај ги податоците</span></span>
<span id="cb14-20"><a href="conversion.html#cb14-20" aria-hidden="true" tabindex="-1"></a>  trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(trosoci_tabela)</span>
<span id="cb14-21"><a href="conversion.html#cb14-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-22"><a href="conversion.html#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Групирај и пресметај суми</span></span>
<span id="cb14-23"><a href="conversion.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span></span>
<span id="cb14-24"><a href="conversion.html#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span></span>
<span id="cb14-25"><a href="conversion.html#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-26"><a href="conversion.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb14-27"><a href="conversion.html#cb14-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="conversion.html#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Направи патека за дестинација</span></span>
<span id="cb14-29"><a href="conversion.html#cb14-29" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">dirname</span>(trosoci_tabela)</span>
<span id="cb14-30"><a href="conversion.html#cb14-30" aria-hidden="true" tabindex="-1"></a>  base_name <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(<span class="fu">basename</span>(trosoci_tabela))</span>
<span id="cb14-31"><a href="conversion.html#cb14-31" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(base_name, <span class="st">&quot;sumirani.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb14-32"><a href="conversion.html#cb14-32" aria-hidden="true" tabindex="-1"></a>  destinacija <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder_name, new_name)</span>
<span id="cb14-33"><a href="conversion.html#cb14-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-34"><a href="conversion.html#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Зачувај</span></span>
<span id="cb14-35"><a href="conversion.html#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(trosoci_sumirani, <span class="at">path =</span> destinacija)</span>
<span id="cb14-36"><a href="conversion.html#cb14-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-37"><a href="conversion.html#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="conversion.html#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Земи го првиот аргумент</span></span>
<span id="cb14-39"><a href="conversion.html#cb14-39" aria-hidden="true" tabindex="-1"></a>dadeni_trosoci <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb14-40"><a href="conversion.html#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="conversion.html#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Изврши ја функцијата</span></span>
<span id="cb14-42"><a href="conversion.html#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu">sumiraj_trosoci</span>(<span class="at">trosoci =</span> dadeni_trosoci)</span></code></pre></div>
<p>Доколку го тестирате кодот додека читате го имате преземено директориумот за овој текст, оваа скрипта и податоците за трошоци се наоѓаат како фолдерот <strong><code>data</code></strong> под името <strong><code>sumiraj-trosoci-1.R</code></strong> и <strong><code>trosoci-moja-firma.csv</code></strong>.</p>
<p>Доколку сакаме навистина да се потрудиме, како поради безбедност така и поради лесно користење на ваквата скрипта, можеме да додадеме кратко упатство за користење, и код за проверка на аргументот.</p>
<p>За да направиме упатство за користење, ќе го користиме пакетот <a href="https://www.rdocumentation.org/packages/docopt/versions/0.7.1"><code>docopt</code></a> кој што користи таканаречен <a href="https://en.wikipedia.org/wiki/Docstring"><code>docstring</code></a>, односно текст којшто следи некои правила за форматирање со цел да биде лесно парсиран како прирачник за употреба на нашата скрипта. <code>docopt/docstring</code> имаат еквиваленти во сите други програмски јазици, така да доколку програмирате во <code>Python</code> или <code>Perl</code> <span class="citation">(<a href="литература.html#ref-wall2000programming" role="doc-biblioref">Wall, Christiansen, and Orwant 2000</a>)</span> веројатно ви се веќе познати овие концепти.</p>
<p>За да провериме дека се е во ред со табелата што и е дадена на скриптата, ќе го користиме пакетот <a href="https://www.rdocumentation.org/packages/assertthat/versions/0.2.1">assertthat</a>, што ни овозможува лесни проверки и информативни пораки за грешката. Стриктно гледано, пакетите <code>docopt</code> и <code>assertthat</code> не се неопходни, можеме да користиме функции како <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/commandArgs"><code>commandArgs()</code></a> и <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/stopifnot"><code>stopifnot()</code></a> од основната дистрибуција на <code>R</code>. Но во некои случаи користење на додатни пакети навистина ја олеснува работата.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="conversion.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (data/sumiraj-trosoci-2.R)</span></span>
<span id="cb15-2"><a href="conversion.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="conversion.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Сумирај трошоци групирани по вработен и тип на трошок. </span></span>
<span id="cb15-4"><a href="conversion.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st"> Табелаta со трошоци мора да ги содржи колоните: `vraboten`, `tip_na_trosok`, и `cena`.</span></span>
<span id="cb15-5"><a href="conversion.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st"> </span></span>
<span id="cb15-6"><a href="conversion.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st"> Usage:</span></span>
<span id="cb15-7"><a href="conversion.html#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">    sumiraj-trosoci-2.R &lt;tabela_so_trosoci&gt;</span></span>
<span id="cb15-8"><a href="conversion.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="st">    sumiraj-trosoci-2.R --help</span></span>
<span id="cb15-9"><a href="conversion.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">    sumiraj-trosoci-2.R --version</span></span>
<span id="cb15-10"><a href="conversion.html#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="conversion.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="st"> Options:</span></span>
<span id="cb15-12"><a href="conversion.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="st">    --help      Прикажи помош</span></span>
<span id="cb15-13"><a href="conversion.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="st">    --version   Прикажи верзија</span></span>
<span id="cb15-14"><a href="conversion.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb15-15"><a href="conversion.html#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span> <span class="ot">-&gt;</span> doc</span>
<span id="cb15-16"><a href="conversion.html#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="conversion.html#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Логика за аргументи</span></span>
<span id="cb15-18"><a href="conversion.html#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(docopt)</span>
<span id="cb15-19"><a href="conversion.html#cb15-19" aria-hidden="true" tabindex="-1"></a>arguments <span class="ot">&lt;-</span> <span class="fu">docopt</span>(doc, <span class="at">version =</span> <span class="st">&quot;Сумирај трошоци 2.0</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb15-20"><a href="conversion.html#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="conversion.html#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Провери дали табелата е csv формат</span></span>
<span id="cb15-22"><a href="conversion.html#cb15-22" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(</span>
<span id="cb15-23"><a href="conversion.html#cb15-23" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">has_extension</span>(arguments<span class="sc">$</span>tabela_so_trosoci, <span class="at">ext =</span> <span class="st">&quot;csv&quot;</span>))</span>
<span id="cb15-24"><a href="conversion.html#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="conversion.html#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Вчитај ги ти пакетите кои се користат подолу</span></span>
<span id="cb15-26"><a href="conversion.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb15-27"><a href="conversion.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb15-28"><a href="conversion.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(readr)</span>
<span id="cb15-29"><a href="conversion.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(assertthat)</span>
<span id="cb15-30"><a href="conversion.html#cb15-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-31"><a href="conversion.html#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="conversion.html#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Доколку не се достапни, инсталирај со:</span></span>
<span id="cb15-33"><a href="conversion.html#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb15-34"><a href="conversion.html#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;readr&quot;)</span></span>
<span id="cb15-35"><a href="conversion.html#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(assertthat)</span></span>
<span id="cb15-36"><a href="conversion.html#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="conversion.html#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Функција за групирање и сумирање трошоци</span></span>
<span id="cb15-38"><a href="conversion.html#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Аргументот `trosoci_tabela` е патека до табелата што треба да се трансформира</span></span>
<span id="cb15-39"><a href="conversion.html#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="conversion.html#cb15-40" aria-hidden="true" tabindex="-1"></a>sumiraj_trosoci <span class="ot">&lt;-</span> <span class="cf">function</span>(trosoci_tabela) {</span>
<span id="cb15-41"><a href="conversion.html#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="conversion.html#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Вчитај ги податоците</span></span>
<span id="cb15-43"><a href="conversion.html#cb15-43" aria-hidden="true" tabindex="-1"></a>  trosoci <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(trosoci_tabela)</span>
<span id="cb15-44"><a href="conversion.html#cb15-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-45"><a href="conversion.html#cb15-45" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">inherits</span>(trosoci, <span class="st">&quot;data.frame&quot;</span>), <span class="at">msg =</span> <span class="st">&quot;Табелата не беше вчитана како `data.frame`.&quot;</span>)</span>
<span id="cb15-46"><a href="conversion.html#cb15-46" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;vraboten&quot;</span>, <span class="st">&quot;tip_na_trosok&quot;</span>, <span class="st">&quot;cena&quot;</span>) <span class="sc">%in%</span> <span class="fu">names</span>(trosoci)), </span>
<span id="cb15-47"><a href="conversion.html#cb15-47" aria-hidden="true" tabindex="-1"></a>                          <span class="at">msg =</span> <span class="st">&quot;Табелата мора да содржи колони со имињата: &#39;vraboten&#39;, &#39;tip_na_trosok&#39;, &#39;cena&#39;.&quot;</span>)</span>
<span id="cb15-48"><a href="conversion.html#cb15-48" aria-hidden="true" tabindex="-1"></a>  assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.numeric</span>(trosoci<span class="sc">$</span>cena), <span class="at">msg =</span> <span class="st">&quot;Колоната `cena` мора да биде нумеричка.&quot;</span>)</span>
<span id="cb15-49"><a href="conversion.html#cb15-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-50"><a href="conversion.html#cb15-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-51"><a href="conversion.html#cb15-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Групирај и пресметај суми</span></span>
<span id="cb15-52"><a href="conversion.html#cb15-52" aria-hidden="true" tabindex="-1"></a>  trosoci_sumirani <span class="ot">&lt;-</span> trosoci <span class="sc">%&gt;%</span></span>
<span id="cb15-53"><a href="conversion.html#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(vraboten, tip_na_trosok) <span class="sc">%&gt;%</span></span>
<span id="cb15-54"><a href="conversion.html#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_at</span>(<span class="st">&quot;cena&quot;</span>, <span class="st">&quot;sum&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-55"><a href="conversion.html#cb15-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(vraboten, tip_na_trosok)</span>
<span id="cb15-56"><a href="conversion.html#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="conversion.html#cb15-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Направи патека за дестинација</span></span>
<span id="cb15-58"><a href="conversion.html#cb15-58" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">dirname</span>(trosoci_tabela)</span>
<span id="cb15-59"><a href="conversion.html#cb15-59" aria-hidden="true" tabindex="-1"></a>  base_name <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(<span class="fu">basename</span>(trosoci_tabela))</span>
<span id="cb15-60"><a href="conversion.html#cb15-60" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(base_name, <span class="st">&quot;sumirani.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb15-61"><a href="conversion.html#cb15-61" aria-hidden="true" tabindex="-1"></a>  destinacija <span class="ot">&lt;-</span> <span class="fu">file.path</span>(folder_name, new_name)</span>
<span id="cb15-62"><a href="conversion.html#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="conversion.html#cb15-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Зачувај</span></span>
<span id="cb15-64"><a href="conversion.html#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(trosoci_sumirani, <span class="at">path =</span> destinacija)</span>
<span id="cb15-65"><a href="conversion.html#cb15-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-66"><a href="conversion.html#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="conversion.html#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Земи го првиот аргумент (табелата)</span></span>
<span id="cb15-68"><a href="conversion.html#cb15-68" aria-hidden="true" tabindex="-1"></a>dadeni_trosoci <span class="ot">&lt;-</span> arguments<span class="sc">$</span>tabela_so_trosoci</span>
<span id="cb15-69"><a href="conversion.html#cb15-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-70"><a href="conversion.html#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Изврши ја функцијата</span></span>
<span id="cb15-71"><a href="conversion.html#cb15-71" aria-hidden="true" tabindex="-1"></a><span class="fu">sumiraj_trosoci</span>(<span class="at">trosoci =</span> dadeni_trosoci)</span></code></pre></div>
<p>Со овие додатоци, нашата скрипта сега ќе може дури и да им помогне на корисниците доколку наидат на грешка. Сѐ уште не сме комплетно безбедни од не-повторливост, но стигнавме далеку имајќи во предвид каде почнавме. На пример, ако ја извршиме скриптата без аргументи:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="conversion.html#cb16-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">Rscript</span> sumiraj-trosoci-2.R </span>
<span id="cb16-2"><a href="conversion.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span>: Сумирај трошоци групирани по вработен и тип на трошок. </span>
<span id="cb16-3"><a href="conversion.html#cb16-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">Табелаta</span> со трошоци мора да ги содржи колоните: <span class="kw">`</span><span class="ex">vraboten</span><span class="kw">`</span>, <span class="kw">`</span><span class="ex">tip_na_trosok</span><span class="kw">`</span>, и <span class="kw">`</span><span class="ex">cena</span><span class="kw">`</span>.</span>
<span id="cb16-4"><a href="conversion.html#cb16-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb16-5"><a href="conversion.html#cb16-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">Usage</span>:</span>
<span id="cb16-6"><a href="conversion.html#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">sumiraj-trosoci-2.R</span> <span class="op">&lt;</span>tabela_so_trosoci<span class="op">&gt;</span></span>
<span id="cb16-7"><a href="conversion.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="conversion.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Execution</span> halted</span></code></pre></div>
<p>Со коректен инпут:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="conversion.html#cb17-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">Rscript</span> sumiraj-trosoci-2.R trosoci-moja-firma.csv </span>
<span id="cb17-2"><a href="conversion.html#cb17-2" aria-hidden="true" tabindex="-1"></a>[<span class="ex">1</span>] TRUE</span>
<span id="cb17-3"><a href="conversion.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Parsed</span> with column specification:</span>
<span id="cb17-4"><a href="conversion.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">cols</span>(</span>
<span id="cb17-5"><a href="conversion.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">vraboten</span> = col_character(),</span>
<span id="cb17-6"><a href="conversion.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">tip_na_trosok</span> = col_character(),</span>
<span id="cb17-7"><a href="conversion.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">cena</span> = col_double()</span>
<span id="cb17-8"><a href="conversion.html#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Со погрешен фајл, праќаме ексел наместо текстуална табела со запирки:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="conversion.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> sumiraj-trosoci-2.R trosoci-moja-firma.xls </span>
<span id="cb18-2"><a href="conversion.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span>: File <span class="st">&#39;trosoci-moja-firma.xls&#39;</span> does not have extension csv</span>
<span id="cb18-3"><a href="conversion.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Execution</span> halted</span></code></pre></div>
<p>Ако колоната за <code>cena</code> е крстена <code>eur</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="conversion.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> sumiraj-trosoci-2.R trosoci-moja-firma-eur.csv</span>
<span id="cb19-2"><a href="conversion.html#cb19-2" aria-hidden="true" tabindex="-1"></a>[<span class="ex">1</span>] TRUE</span>
<span id="cb19-3"><a href="conversion.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Parsed</span> with column specification:</span>
<span id="cb19-4"><a href="conversion.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">cols</span>(</span>
<span id="cb19-5"><a href="conversion.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">vraboten</span> = col_character(),</span>
<span id="cb19-6"><a href="conversion.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">tip_na_trosok</span> = col_character(),</span>
<span id="cb19-7"><a href="conversion.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">eur</span> = col_double()</span>
<span id="cb19-8"><a href="conversion.html#cb19-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-9"><a href="conversion.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span>: Табелата мора да содржи колони со имињата: <span class="st">&#39;vraboten&#39;</span>, <span class="st">&#39;tip_na_trosok&#39;</span>, <span class="st">&#39;cena&#39;</span>.</span>
<span id="cb19-10"><a href="conversion.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Execution</span> halted</span></code></pre></div>
</div>
<div id="резиме-2" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Резиме</h2>
<p>Во ова поглавје видовме како нашите едноставни три линии код напишани набрзина можеме да ги претвориме во постабилна скрипта која веќе ги има следните карактеристики значајни за повторливост:</p>
<ul>
<li>Сите зависности на кодот се експлицитно наведени и пакетите се вчитани<br />
</li>
<li>Скриптата <em>не</em> зависи од нашата работна средина<br />
</li>
<li>Имаме далеку подобра документација, како за корисници кои ќе го отворат фајлот, така и за тие кои само ќе ја вчитаат скриптата<br />
</li>
<li>Имаме неколку проверки/валидации на табелата што се трансформира – мора да осигураме дека табелата ги исполнува потребите пред да почнеме да сумираме<br />
</li>
<li>Имаме автоматско составување на името за зачувување од коренот на името на табелата што ја праќаме во скриптата</li>
</ul>
<p>Сите овие чекори придонесуваат до побезбедно и одбранбено (дефенсивно) програмирање, односно пракса која ги зголемува шансите дека некој код ќе работи како што се очекува надвор од контекстот во кој бил креиран. Во овој случај, контекстот на креирање беше нашата <code>R</code> сесија со 10 вчитани пакети и датотека зачувана во <code>~/Downloads</code> на <code>Linux</code> оперативен систем. Видовме дека и само еден од овие аспекти на работната средина да варира кај нашите колеги, нашата скрипта нема да работи без тие да почнат да го менуваат изворниот код. Но со наведените подобрувања ги предвидуваме и надминуваме голем дел од овие проблеми.</p>
<p>Независно, иако направиме голем напредок кон повторлива обработка на податоци, сѐ уште правиме некакви претпоставки за контекстот во кој скриптата ќе биде користена. На пример, претпоставуваме дека сите потенцијални корисници ќе имаат табелата со трошoци, дека сите корисници ќе имаат <code>R</code> и <code>Rscript</code> инсталирано за да можат да ја извршат скриптата, и дека сите корисници ќе ги имаат инсталирано библиотеките од кои зависи нашата скрипта. Во следните поглавја ќе разгледаме начини на кои може да составиме повторливи проекти кои вклучуваат многу скрипти и податоци и прават минимални претпоставки за средината во која некој ќе се обиде да ја повтори нашата анализа.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="nogood.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmd.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["booklet.pdf", "booklet.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
